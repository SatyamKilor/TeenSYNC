<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TeenSYNC - Home Feed</title>
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css" rel="stylesheet" />
</head>
<style>
    :root {
    --purple: #9333ea;
    --light-blue: #6366f1;
    --dark-blue: #302b63;
    --dark-gray: #374151;
    --medium-gray: #9ca3af;
    --white: #ffffff;
    --light-purple: #8b5cf6;
    --black: #0f0c29;
    
    /* Dark theme colors */
    --background: #0f172a;
    --surface: #1e293b;
    --surface-lighter: #334155;
    --text-primary: #f1f5f9;
    --text-secondary: #94a3b8;
    --border-color: #334155;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen,
        Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
}

body {
    background-color: var(--background);
    color: var(--text-primary);
}

.container {
    display: grid;
    grid-template-columns: 280px 1fr 300px;
    gap: 24px;
    max-width: 1440px;
    margin: 0 auto;
    padding: 24px;
    min-height: 100vh;
}

/* App Title */
.app-title {
    font-size: 2.5rem;
    font-weight: 700;
    background: linear-gradient(135deg, var(--purple), var(--light-blue));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    margin-bottom: 24px;
    letter-spacing: -0.5px;
}

/* Navbar Styles */
.navbar {
    background: var(--surface);
    padding: 16px;
    border-radius: 16px;
    display: flex;
    justify-content: space-around;
    margin-bottom: 24px;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2);
    border: 1px solid var(--border-color);
}

.nav-button {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s;
    padding: 8px 16px;
    border-radius: 8px;
    text-decoration:  none;
}

.nav-button span {
    font-size: 12px;
    font-weight: 500;
}

.nav-button i {
    font-size: 20px;
}

.nav-button:hover,
.nav-button.active {
    color: var(--purple);
    background-color: var(--surface-lighter);
}

/* Sidebar Styles */
.sidebar {
    background: var(--surface);
    border-radius: 16px;
    padding: 20px;
    height: calc(100vh - 48px);
    position: sticky;
    top: 24px;
    border: 1px solid var(--border-color);
}

.sidebar-section {
    margin-bottom: 24px;
}

.sidebar-section h3 {
    font-size: 12px;
    color: var(--text-secondary);
    margin-bottom: 12px;
    font-weight: 600;
}

.group-item, .friend-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 8px;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.2s;
    color: var(--text-primary);
    text-decoration: none;
}

.group-item:hover, .friend-item:hover {
    background-color: var(--surface-lighter);
}

/* Avatar Styles */
.avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--purple), var(--light-blue));
    color: var(--white);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    font-weight: 500;
}

/* Status Indicator */
.status {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background-color: var(--text-secondary);
    margin-left: auto;
}

.status.online {
    background-color: #10b981;
}

/* Main Content Styles */
.main-content {
    padding: 20px 0;
}

/* Post Styles */
.post {
    background: var(--surface);
    border-radius: 16px;
    margin-bottom: 24px;
    display: flex;
    overflow: hidden;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2);
    border: 1px solid var(--border-color);
}

.post-image {
    width: 200px;
    min-width: 200px;
    height: 200px;
    overflow: hidden;
}

.post-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.post-details {
    flex: 1;
    padding: 20px;
}

.post-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}

.post-meta {
    display: flex;
    align-items: center;
    gap: 12px;
}

.post-meta h4 {
    font-weight: 600;
    color: var(--text-primary);
}

.timestamp {
    font-size: 12px;
    color: var(--text-secondary);
}

.post-content {
    margin-bottom: 16px;
    line-height: 1.5;
    color: var(--text-primary);
}

.post-actions {
    display: flex;
    gap: 16px;
}

/* Button Styles */
.icon-button {
    width: 36px;
    height: 36px;
    border-radius: 8px;
    text-decoration: none;
    border: none;
    background: var(--surface-lighter);
    color: var(--text-secondary);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.2s;
}

.icon-button:hover {
    background-color: var(--dark-gray);
    color: var(--text-primary);
}

.action-button {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 12px;
    border-radius: 8px;
    border: none;
    background: var(--surface-lighter);
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s;
    text-decoration: none;
}

.action-button:hover {
    background-color: var(--dark-gray);
    color: var(--purple);
}

/* Right Sidebar - Chat Rooms */
.chat-rooms {
    background: var(--surface);
    border-radius: 16px;
    padding: 20px;
    border: 1px solid var(--border-color);
    max-height: 50%;
    overflow-y: scroll;
}

.chat-rooms::-webkit-scrollbar{
  display: none;
}

.chat-rooms-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}

.chat-rooms-header h3 {
    font-size: 12px;
    color: var(--text-secondary);
    font-weight: 600;
    text-transform: uppercase;
}

.chat-room-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    margin-bottom: 8px;
    text-decoration: none;
}

.chat-room-item:hover {
    background-color: var(--surface-lighter);
}

.chat-room-item.active {
    background-color: var(--surface-lighter);
    border: 1px solid var(--purple);
}

.chat-room-info {
    display: flex;
    align-items: center;
    gap: 12px;
    flex: 1;
}

.chat-room-info i {
    font-size: 24px;
    color: var(--purple);
}

.chat-room-details h4 {
    color: var(--text-primary);
    font-size: 14px;
    font-weight: 500;
    margin-bottom: 2px;
}

.chat-room-details p {
    color: var(--text-secondary);
    font-size: 12px;
    margin: 0;
}


/* Responsive Design */
@media (max-width: 1200px) {
    .container {
        grid-template-columns: 240px 1fr;
    }
    .sidebar.right {
        display: none;
    }
}

@media (max-width: 768px) {


    .container {
        grid-template-columns: 1fr;
    }
    .sidebar {
        display: none;
    }
    .post {
        flex-direction: column;
    }
    .post-image {
        width: 100%;
        height: 100%;
        
    }
}
</style>
<body>
    <div class="container">
        <!-- Left Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h1 class="app-title">TeenSync</h1>
            </div>

            <div class="sidebar-section">
              <% let userFollowers = loggedUser.followers; %>
                <h3>FRIENDS</h3>
                <% userFollowers.map( (follower) =>{ %>
                  <a class="friend-item" href="/<%= follower._id %>/profile">
                    <img class="avatar" src="<%= follower.profilePicture %>" alt="">
                    <span><%= follower.username %></span>
                  </a>
                <% }) %>
            </div>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Navigation Bar -->
            <nav class="navbar">

                <a class="nav-button active" href="/home">
                  <i class="ph ph-house"></i>
                    <span>Home</span>
                </a>

                <a class="nav-button" href="/chat">
                  <i class="ph ph-chat-circle"></i>
                    <span>Chat</span>
                </a>
                
                <a class="nav-button" href="/search">
                  <i class="ph ph-magnifying-glass"></i>
                    <span>Search</span>
                </a>
                
                <a class="nav-button" href="/profile">
                  <i class="ph ph-user-circle"></i>
                    <span>Profile</span>
                </a>
            </nav>

            <!-- Posts -->
            <div class="posts">
              <% posts.map((post)=>{ %>
                <% users.map((user) => { %>
                  <% let userID = user._id.toString(); %>
                  <% let postAuthor = post.author.toString(); %>
                  <% if (userID === postAuthor) { %>
                      <% PostCreator = user; %> 
                  <% } %>
              <% }) %>
                <div class="post">
                    <div class="post-image">
                        <img src="<%= post.contents %>" alt="Post image">
                    </div>
                    <div class="post-details">
                        <div class="post-header">
                            <div class="post-meta">
                                <img class="avatar" src="<%= PostCreator.profilePicture %>" alt="">
                                <div>
                                  <a style="text-decoration: none;" href="/<%= post.author %>/profile">
                                    <h4><%= PostCreator.username %></h4>
                                  </a>
                                    <% const date = new Date(post.createdAt);  %>
                                    <% const month = date.toLocaleString('default', { month: 'short' }); %>
                                    <% const day = date.getDate(); %>
                                    <% const year = date.getFullYear(); %>
                                    <% const formattedDate = `${month} ${day}, ${year}`; %>
                                    <span class="timestamp"><%= formattedDate %></span>
                                </div>
                            </div>
                            <a class="icon-button" href="/<%= post.author._id%>/profile">
                              <i class="ph ph-user"></i>
                            </a>

                        </div>
                        <div class="post-content">
                            <p><%= post.caption %></p>
                        </div>
                        <div class="post-actions">
                          <% let upvoted = post.upvotes.find(upvote => upvote.toString() === loggedUser._id.toString()); %>
                          <% if (upvoted) { %>
                          <button href="" class="action-button ri-thumb-up-fill" data-post-id="<%= post._id %>">
                            <span><%= post.upvotes.length %></span>
                          </button>
                          <% } else { %>
                            <button href="" class="action-button ri-thumb-up-line" data-post-id="<%= post._id %>">
                              <span><%= post.upvotes.length %></span>
                            </button>
                          <% } %>
                            <a class="action-button" href="mailto:satyamkilor8@gmail.com">
                              <i class="ph ph-warning-circle"></i>
                            </a>
                        </div>
                    </div>
                </div>
              <% }) %>

                
            </div>
        </main>

        <!-- Right Sidebar -->
        <div class="sidebar right">
            <div class="chat-rooms">
                <div class="chat-rooms-header">
                    <h3>YOUR DISCUSSIONS</h3>
                    <a class="icon-button" href="/discussions">
                        <i class="ph ph-plus"></i>
                    </a>
                </div>
                <% UserDiscussions.map((discussion)=>{ %>
                  <a class="chat-room-item " href="/discussion/<%= discussion._id %>">
                    <div class="chat-room-info">
                        <i class="ph ph-chats-circle"></i>
                        <div class="chat-room-details">
                            <h4><%= discussion.title %></h4>
                            <p><%= discussion.participants.length %> Members</p>
                        </div>
                    </div>
                </a>
                <% }) %>
                
            </div>
        </div>
    </div>

    <script>

      let upvoteBtns = document.querySelectorAll('.ri-thumb-up-line');
      upvoteBtns.forEach(btn => {
        btn.addEventListener('click', async () => {
          const postId = btn.getAttribute('data-post-id'); 
          let success = await fetch(`/api/v1/post/${postId}/upvote`, {
                method: 'GET',
                headers: {
                  'Content-Type': 'application/json',
                  'Authorization': `Bearer ${localStorage.getItem('token')}`,
                }
              });
              window.location.reload();
        });
      });
      

      const unUpvoteBtns = document.querySelectorAll('.ri-thumb-up-fill');
      unUpvoteBtns.forEach(btn => {
        btn.addEventListener('click', async () => {
          const postId = btn.getAttribute('data-post-id'); 
          let success = await fetch(`/api/v1/post/${postId}/unupvote`, {
                method: 'GET',
                headers: {
                  'Content-Type': 'application/json',
                  'Authorization': `Bearer ${localStorage.getItem('token')}`,
                }
              });
              window.location.reload();
            });
      });
    
    
    </script>
  
</body>
</html>